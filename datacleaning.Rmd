---
title: "datacleaning"
author: "Rebecca Owens"
date: "2025-09-23"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(stringr)
library(forcats)
library(readxl)


df <- read_excel("/Users/rebeccaowens/Desktop/data1/DATA2x02_survey_2025_Responses.xlsx")

df_cleaned <- df %>%
  mutate(
    `Which unit are you enrolled in?` = as.factor(`Which unit are you enrolled in?`),
    `Do you submit assignments on time?` = as.factor(`Do you submit assignments on time?`),
    `Have you ever used R before starting DATA2x02?` = as.factor(`Have you ever used R before starting DATA2x02?`),
    `What kind of role (active or passive) do you think you are when working as part of a team?` = as.factor(`What kind of role (active or passive) do you think you are when working as part of a team?`),
    `What is your favourite anime?` = str_trim(`What is your favourite anime?`),
    `How many hours a week (on average) do you work in paid employment?` = as.numeric(`How many hours a week (on average) do you work in paid employment?`),
    `Which year of university are you currently in?` = as.factor(`Which year of university are you currently in?`),
    `How many languages can you speak fluently?` = as.integer(`How many languages can you speak fluently?`),
    `How many languages can you read?` = as.integer(`How many languages can you read?`),
    `How old are you?` = as.integer(`How old are you?`),
    `How many Weet-Bix would you typically eat in one sitting?` = as.integer(`How many Weet-Bix would you typically eat in one sitting?`),
    `What is the average amount of money you spend each week on food/beverages?` = as.numeric(`What is the average amount of money you spend each week on food/beverages?`),
    `What country were you born in?` = as.factor(`What country were you born in?`),
    `Do you tend to lean towards saying "yes" or towards saying "no" to things throughout life?` = as.factor(`Do you tend to lean towards saying "yes" or towards saying "no" to things throughout life?`),
    `Do you pay rent?` = as.factor(`Do you pay rent?`),
    `Do you believe in the existence of aliens (Extraterrestrial Life)?` = as.factor(`Do you believe in the existence of aliens (Extraterrestrial Life)?`),
    `Do you work?` = as.factor(`Do you work?`),
    `What is your gender?` = as.factor(`What is your gender?`),
    `What are your current living arrangements?` = as.factor(`What are your current living arrangements?`),
    `What is your favourite social media platform?` = as.factor(`What is your favourite social media platform?`)
  )


df_select <- df_cleaned %>%
  select(
    unit = `Which unit are you enrolled in?`,
    exercise_hours = `On average, how many hours each week do you spend exercising?`,
    work_hours = `How many hours a week (on average) do you work in paid employment?`,
    submit_on_time = `Do you submit assignments on time?`,
    used_r_before = `Have you ever used R before starting DATA2x02?`,
    team_role = `What kind of role (active or passive) do you think you are when working as part of a team?`,
    uni_year = `Which year of university are you currently in?`,
    fav_anime = `What is your favourite anime?`,
    fluent_languages = `How many languages can you speak fluently?`,
    readable_languages = `How many languages can you read?`,
    country_birth = `What country were you born in?`,
    grade_goal = `What final grade are you aiming to achieve in DATA2x02?`,
    manage_assignments = `When it comes to assignments / due tasks do you:`,
    trimester_preference = `Would you prefer to have a trimester system (3 main teaching sessions per year) or stick with the existing semester system (2 main teaching sessions per year)?`,
    age = `How old are you?`,
    say_yes_or_no = `Do you tend to lean towards saying "yes" or towards saying "no" to things throughout life?`,
    pays_rent = `Do you pay rent?`,
    bathroom_stall_choice = `You enter a public bathroom and there are three stalls to choose from. All three are unoccupied. Which do you choose?`,
    weetbix_per_sitting = `How many Weet-Bix would you typically eat in one sitting?`,
    weekly_food_spend = `What is the average amount of money you spend each week on food/beverages?`
  )


```

```{r}
library(dplyr)
library(stringr)
library(forcats)

# Normalize fav_anime
df_select$fav_anime <- tolower(df_select$fav_anime)
df_select$fav_anime <- str_replace_all(df_select$fav_anime, "[[:punct:]]", "")
df_select$fav_anime <- str_trim(df_select$fav_anime)
df_select$fav_anime <- str_replace_all(df_select$fav_anime, "\\s+", " ")
none_pattern <- "^none$|^no$|i don't watch|dont watch|nope|not applicable|n/a|na"
df_select$fav_anime <- ifelse(str_detect(df_select$fav_anime, none_pattern), "none/no", df_select$fav_anime)
top_animes <- df_select %>% count(fav_anime) %>% arrange(desc(n)) %>% slice_head(n = 10) %>% pull(fav_anime)
df_select$fav_anime <- fct_other(df_select$fav_anime, keep = top_animes, other_level = "Other")

df_select$country_birth <- tolower(df_select$country_birth)
df_select$country_birth <- str_replace_all(df_select$country_birth, "[[:punct:]]", "")
df_select$country_birth <- str_trim(df_select$country_birth)
df_select$country_birth <- str_replace_all(df_select$country_birth, "\\s+", " ")

df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "usa|america|united states"), "usa", df_select$country_birth)
df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "australia|aus"), "australia", df_select$country_birth)
df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "uk|england|great britain|britain"), "uk", df_select$country_birth)
df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "new zealand|nz"), "new zealand", df_select$country_birth)
df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "vietnam|viet nam"), "vietnam", df_select$country_birth)



top_countries <- df_select %>% count(country_birth) %>% arrange(desc(n)) %>% slice_head(n = 10) %>% pull(country_birth)
df_select$country_birth <- fct_other(df_select$country_birth, keep = top_countries, other_level = "Other")

```

```{r}
zscore_filter <- function(x, threshold = 3) {
  if (!is.numeric(x)) return(rep(TRUE, length(x)))
  z <- (x - mean(x, na.rm = TRUE)) / sd(x, na.rm = TRUE)
  abs(z) < threshold | is.na(z)
}

df_no_outliers <- df_select %>%
  filter(
    zscore_filter(exercise_hours),
    zscore_filter(work_hours),
    zscore_filter(fluent_languages),
    zscore_filter(readable_languages),
    zscore_filter(age),
    zscore_filter(weetbix_per_sitting),
    zscore_filter(weekly_food_spend)
  )
```


```{r}
finaldf <- df_no_outliers

cat_vars <- names(finaldf)[!sapply(finaldf, is.numeric)]
num_vars <- names(finaldf)[sapply(finaldf, is.numeric)]


all_vars <- c(cat_vars, num_vars)
var_type <- c(rep("Categorical", length(cat_vars)), rep("Numeric", length(num_vars)))

num_vars
cat_vars
```
```{r}
saveRDS(finaldf, file = "cleaned_data.rds") 
```

