---
title: "datacleaning"
author: "Rebecca Owens"
date: "2025-09-23"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(stringr)
library(forcats)
library(readxl)


df <- read_excel("/Users/rebeccaowens/Desktop/data1/DATA2x02_survey_2025_Responses.xlsx")

df_cleaned <- df %>%
  mutate(
    `Which unit are you enrolled in?` = as.factor(`Which unit are you enrolled in?`),
    `Do you submit assignments on time?` = as.factor(`Do you submit assignments on time?`),
    `Have you ever used R before starting DATA2x02?` = as.factor(`Have you ever used R before starting DATA2x02?`),
    `What kind of role (active or passive) do you think you are when working as part of a team?` = as.factor(`What kind of role (active or passive) do you think you are when working as part of a team?`),
    `What is your favourite anime?` = str_trim(`What is your favourite anime?`),
    `How many hours a week (on average) do you work in paid employment?` = as.numeric(`How many hours a week (on average) do you work in paid employment?`),
    `Which year of university are you currently in?` = as.factor(`Which year of university are you currently in?`),
    `How many languages can you speak fluently?` = as.integer(`How many languages can you speak fluently?`),
    `How many languages can you read?` = as.integer(`How many languages can you read?`),
    `How old are you?` = as.integer(`How old are you?`),
    `How many Weet-Bix would you typically eat in one sitting?` = as.integer(`How many Weet-Bix would you typically eat in one sitting?`),
    `What is the average amount of money you spend each week on food/beverages?` = as.numeric(`What is the average amount of money you spend each week on food/beverages?`),
    `What country were you born in?` = as.factor(`What country were you born in?`),
    `Do you tend to lean towards saying "yes" or towards saying "no" to things throughout life?` = as.factor(`Do you tend to lean towards saying "yes" or towards saying "no" to things throughout life?`),
    `Do you pay rent?` = as.factor(`Do you pay rent?`),
    `Do you believe in the existence of aliens (Extraterrestrial Life)?` = as.factor(`Do you believe in the existence of aliens (Extraterrestrial Life)?`),
    `Do you work?` = as.factor(`Do you work?`),
    `What is your gender?` = as.factor(`What is your gender?`),
    `What are your current living arrangements?` = as.factor(`What are your current living arrangements?`),
    `What is your favourite social media platform?` = as.factor(`What is your favourite social media platform?`)
  )


df_select <- df_cleaned %>%
  select(
    unit = `Which unit are you enrolled in?`,
    exercise_hours = `On average, how many hours each week do you spend exercising?`,
    work_hours = `How many hours a week (on average) do you work in paid employment?`,
    submit_on_time = `Do you submit assignments on time?`,
    used_r_before = `Have you ever used R before starting DATA2x02?`,
    team_role = `What kind of role (active or passive) do you think you are when working as part of a team?`,
    uni_year = `Which year of university are you currently in?`,
    fav_anime = `What is your favourite anime?`,
    fluent_languages = `How many languages can you speak fluently?`,
    readable_languages = `How many languages can you read?`,
    country_birth = `What country were you born in?`,
    grade_goal = `What final grade are you aiming to achieve in DATA2x02?`,
    manage_assignments = `When it comes to assignments / due tasks do you:`,
    trimester_preference = `Would you prefer to have a trimester system (3 main teaching sessions per year) or stick with the existing semester system (2 main teaching sessions per year)?`,
    age = `How old are you?`,
    say_yes_or_no = `Do you tend to lean towards saying "yes" or towards saying "no" to things throughout life?`,
    pays_rent = `Do you pay rent?`,
    bathroom_stall_choice = `You enter a public bathroom and there are three stalls to choose from. All three are unoccupied. Which do you choose?`,
    weetbix_per_sitting = `How many Weet-Bix would you typically eat in one sitting?`,
    weekly_food_spend = `What is the average amount of money you spend each week on food/beverages?`
  )


```

```{r}
library(dplyr)
library(stringr)
library(forcats)

df_select$fav_anime <- tolower(df_select$fav_anime)
df_select$fav_anime <- str_replace_all(df_select$fav_anime, "[[:punct:]]", "")
df_select$fav_anime <- str_trim(df_select$fav_anime)
df_select$fav_anime <- na_if(df_select$fav_anime, "")
df_select$fav_anime <- na_if(df_select$fav_anime, " ")
df_select$fav_anime <- str_replace_all(df_select$fav_anime, "\\s+", " ")
none_pattern <- "^none$|^no$|i don't watch|dont watch|nope|not applicable|n/a|na"
df_select$fav_anime <- ifelse(str_detect(df_select$fav_anime, none_pattern), "none", df_select$fav_anime)
top_animes <- df_select %>% count(fav_anime) %>% arrange(desc(n)) %>% slice_head(n = 10) %>% pull(fav_anime)
df_select$fav_anime <- fct_other(df_select$fav_anime, keep = top_animes, other_level = "Other")

df_select$country_birth <- tolower(df_select$country_birth)
df_select$country_birth <- str_replace_all(df_select$country_birth, "[[:punct:]]", "")
df_select$country_birth <- str_trim(df_select$country_birth)
df_select$country_birth <- str_replace_all(df_select$country_birth, "\\s+", " ")

df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "usa|america|united states"), "usa", df_select$country_birth)
df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "australia|aus"), "australia", df_select$country_birth)
df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "uk|england|great britain|britain"), "uk", df_select$country_birth)
df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "new zealand|nz"), "new zealand", df_select$country_birth)
df_select$country_birth <- ifelse(str_detect(df_select$country_birth, "vietnam|viet nam"), "vietnam", df_select$country_birth)



top_countries <- df_select %>% count(country_birth) %>% arrange(desc(n)) %>% slice_head(n = 10) %>% pull(country_birth)
df_select$country_birth <- fct_other(df_select$country_birth, keep = top_countries, other_level = "Other")



df_select$pays_rent <- fct_other(df_select$pays_rent, keep = c("Yes", "No"), other_level = NA)
df_select$pays_rent <- fct_drop(df_select$pays_rent)

df_select$trimester_preference <- fct_other(df_select$trimester_preference, keep = c("Semester", "Trimester"), other_level = NA)
df_select$trimester_preference <- fct_drop(df_select$trimester_preference)


df_select <- df_select %>%
  mutate(uni_year = factor(
    uni_year,
    levels = c("First year", "Second year", "Third year", "Fourth year","Fifth or higher year"), 
    ordered = TRUE
  ))


```

```{r}
zscore_filter <- function(x, threshold = 3) {
  if (!is.numeric(x)) return(rep(TRUE, length(x)))
  z <- (x - mean(x, na.rm = TRUE)) / sd(x, na.rm = TRUE)
  abs(z) < threshold | is.na(z)
}

df_no_outliers <- df_select %>%
  filter(
    zscore_filter(exercise_hours),
    zscore_filter(work_hours),
    zscore_filter(fluent_languages),
    zscore_filter(readable_languages),
    zscore_filter(age),
    zscore_filter(weetbix_per_sitting),
    zscore_filter(weekly_food_spend)
  ) %>%
  mutate(across(where(is.factor), fct_drop))
```


```{r}
data_dictionary <- data.frame(
  Variable = c(
    "unit",
    "exercise_hours",
    "work_hours",
    "submit_on_time",
    "used_r_before",
    "team_role",
    "uni_year",
    "fav_anime",
    "fluent_languages",
    "readable_languages",
    "country_birth",
    "grade_goal",
    "manage_assignments",
    "trimester_preference",
    "age",
    "say_yes_or_no",
    "pays_rent",
    "bathroom_stall_choice",
    "weetbix_per_sitting",
    "weekly_food_spend"
  ),
  Full_Name = c(
    "Which unit are you enrolled in?",
    "On average, how many hours each week do you spend exercising?",
    "How many hours a week do you work in paid employment?",
    "Do you submit assignments on time?",
    "Have you ever used R before starting DATA2x02?",
    "What kind of role (active or passive) do you think you are when working as part of a team?",
    "Which year of university are you currently in?",
    "What is your favourite anime?",
    "How many languages can you speak fluently?",
    "How many languages can you read?",
    "What country were you born in?",
    "What final grade are you aiming to achieve in DATA2x02?",
    "When it comes to assignments / due tasks do you:",
    "Would you prefer to have a trimester system (3 main teaching sessions per year) or stick with the existing semester system (2 main teaching sessions per year)?",
    "How old are you?",
    "Do you tend to lean towards saying 'yes' or towards saying 'no' to things throughout life?",
    "Do you pay rent?",
    "You enter a public bathroom and there are three stalls to choose from. All three are unoccupied. Which do you choose?",
    "How many Weet-Bix would you typically eat in one sitting?",
    "What is the average amount of money you spend each week on food/beverages?"
  ),
  
  Short_Name = c(
  "Unit",
  "Exercise Hours",
  "Work Hours",
  "Submit On Time",
  "Used R Before",
  "Team Role",
  "University Year",
  "Favourite Anime",
  "Fluent Languages",
  "Readable Languages",
  "Country of Birth",
  "Grade Goal",
  "Manage Assignments",
  "Trimester Preference",
  "Age",
  "Say Yes or No",
  "Pay Rent",
  "Bathroom Stall Choice",
  "Weet-Bix per Sitting",
  "Weekly Food Spend"
), 

  Description = c(
    "Identifies the unit in which the student is enrolled.",
    "Self-reported number of weekly hours spent exercising.",
    "Self-reported average weekly hours in paid work.",
    "Whether the student typically submits assignments on time.",
    "Prior experience with the R programming language before starting the unit.",
    "Self-perception of role in group work (active contributor or passive member).",
    "The year of university study the student is currently in.",
    "Favourite anime as given by the student.",
    "Number of languages the student can speak fluently.",
    "Number of languages the student can read with understanding.",
    "Country of birth as reported by the student.",
    "Target final grade the student hopes to achieve in the unit.",
    "How the student manages assignments and deadlines (planned vs last-minute).",
    "Preference for trimester vs semester system.",
    "Age of the student in years.",
    "General tendency to respond 'yes' or 'no' in life situations.",
    "Whether the student pays rent for accommodation.",
    "Hypothetical bathroom stall choice (first, middle, last).",
    "Typical number of Weet-Bix eaten in one sitting.",
    "Self-reported weekly food and beverage spending."
  ),
Cleaning_Steps = c(
  "Converted to a factor variable; NA values dropped; unused levels removed.",
  "Converted to numeric hours; NA values dropped; outliers removed using z-scores (>3 standard deviations).",
  "Converted to numeric hours; NA values dropped; outliers removed using z-scores.",
  "Converted to a factor variable; NA values dropped; unused levels removed.",
  "Converted to a factor variable; NA values dropped; unused levels removed.",
  "Converted to a factor variable; NA values dropped; unused levels removed.",
  "Converted to numeric year level; NA values dropped; unused levels removed.",
  "Lowercased, punctuation removed, whitespace trimmed, blank entries set to NA, common 'none' responses standardised; top 10 responses kept, others grouped as 'Other'; NA values dropped; unused levels removed.",
  "Converted to numeric count of fluent languages; NA values dropped; outliers removed using z-scores.",
  "Converted to numeric count of readable languages; NA values dropped; outliers removed using z-scores.",
  "Lowercased, punctuation removed, whitespace trimmed, country names standardised (e.g., 'usa', 'australia', 'uk', 'new zealand', 'vietnam'); top 10 responses kept, others grouped as 'Other'; NA values dropped; unused levels removed.",
  "Factor variable representing grade goal; NA values dropped; unused levels removed.",
  "Factor variable describing assignment start habits; NA values dropped; unused levels removed.",
  "Filtered to keep only 'Semester' and 'Trimester' responses; NA values dropped.",
  "Converted to numeric age; NA values dropped; outliers removed using z-scores.",
  "Factor variable representing yes/no tendency; NA values dropped; unused levels removed.",
  "Filtered to keep only 'Yes' and 'No' responses; NA values dropped.",
  "Factor variable describing choice of bathroom stall; NA values dropped; unused levels removed.",
  "Converted to numeric count of Weet-Bix per sitting; NA values dropped; outliers removed using z-scores.",
  "Converted to numeric AUD dollars spent weekly on food; NA values dropped; outliers removed using z-scores."
)
,
  stringsAsFactors = FALSE
)



```

```{r}
colnames(data_dictionary)
```


```{r}
finaldf <- df_no_outliers

cat_vars <- names(finaldf)[!sapply(finaldf, is.numeric)]
num_vars <- names(finaldf)[sapply(finaldf, is.numeric)]


all_vars <- c(cat_vars, num_vars)
var_type <- c(rep("Categorical", length(cat_vars)), rep("Numeric", length(num_vars)))


```
```{r}
saveRDS(finaldf, file = "cleaned_data.rds") 
```

